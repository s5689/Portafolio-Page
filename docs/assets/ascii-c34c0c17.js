import"./modulepreload-polyfill-3cfb730f.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const A=["black","rgba(0, 0, 128, 1)","rgba(0, 128, 0, 1)","rgba(0, 128, 128, 1)","rgba(128, 0, 0, 1)","rgba(128, 0, 128, 1)","rgba(128, 128, 0, 1)","rgba(192, 192, 192, 1)","rgba(128, 128, 128, 1)","rgba(0, 0, 255, 1)","rgba(0, 255, 0, 1)","rgba(0, 255, 255, 1)","rgba(255, 0, 0, 1)","rgba(255, 0, 255, 1)","rgba(255, 255, 0, 1)","rgba(255, 255, 255, 1)","rgba(0, 0, 0, 0)"],l={_char:"",charCallbacks:[],get char(){return this._char},set char(e){this._char=e,Object.values(this.charCallbacks).forEach(t=>t(e))},onCharChange(e,t){this.charCallbacks[e]=t},offCharChange(e){delete this.charCallbacks[e]},_color:"",colorCallbacks:{},get color(){return this._color},set color(e){this._color=e,Object.values(this.colorCallbacks).forEach(t=>t(e))},onColorChange(e,t){this.colorCallbacks[e]=t},offColorChange(e){delete this.colorCallbacks[e]},_background:"",backgroundCallbacks:{},get background(){return this._background},set background(e){this._background=e,Object.values(this.backgroundCallbacks).forEach(t=>t(e))},onBackgroundChange(e,t){this.backgroundCallbacks[e]=t},offBackgroundCallback(e){delete this.backgroundCallbacks[e]},_layer:null,layerCallbacks:{},get layer(){return this._layer},set layer(e){Object.values(this.layerCallbacks).forEach(t=>t(e)),this._layer=e},onLayerChange(e,t){this.layerCallbacks[e]=t},offLayerCallback(e){delete this.layerCallbacks[e]},_tool:null,toolCallbacks:{},get tool(){return this._tool},set tool(e){this._tool=e,Object.values(this.toolCallbacks).forEach(t=>t(e))},onToolChange(e,t){this.toolCallbacks[e]=t},offToolChange(e){delete this.toolCallbacks[e]}},p={_prevSize:{x:0,y:0},_size:{x:0,y:0},sizeCallbacks:{},get size(){return this._size},setSize(e,t){this._prevSize=this._size,this._size={x:e,y:t},Object.values(this.sizeCallbacks).forEach(n=>n(this._size,this._prevSize))},applyChanges(){this.setSize(this._size.x,this._size.y)},onSizeChange(e,t){this.sizeCallbacks[e]=t},offSizeChange(e){delete this.sizeCallbacks[e]}},k={layerList:{},callbacks:{},getSize(){return Object.keys(this.layerList).length-1},save(e){const t=e.parentElement.id,n=document.querySelectorAll(`#${t} tr`);this.layerList[t]=[],n.forEach(o=>{const r=[];for(let i=0;i<o.children.length;i++)r.push(o.children[i]);this.layerList[t].push(r)}),Object.values(this.callbacks).forEach(o=>o(e))},remove(e){delete this.layerList[e]},onChange(e,t){this.callbacks[e]=t},offChange(e){delete this.callbacks[e]}};function u(e){return document.getElementById(e)}function T(e){return document.querySelector(e)}function N(e,t){document.querySelectorAll(e).forEach((n,o)=>{t(n,o)})}function L(e){return getComputedStyle(typeof e=="string"?u(e):e)}const R=[{name:"Todo",value:["0ØΘ°ºª∞ø  ","1¹      ¼½","2²        ","3ЭЗ³эз   ¾","4         ","56789     ","          ","          ","AÀÁÂÃÄÅĂĄÆ","aàáâãäåăąæ","ДЛ        ","дл        ","BБßЪЫЬ    ","bбвъыь    ","CĆČÇ©     ","cćčç¢     ","DĎÐ       ","dďđ       ","EÈÉÊËЁĚĘΣЄ","eèéêëёěęεє","@£€       ","F         ","fƒ        ","G         ","g         ","HН        ","hн        ","IÌÍÎÏЇІ   ","iìíîïїі   ","J         ","j         ","K         ","kк        ","LĹĽŁ      ","lĺľłı     ","M         ","mм        ","NŃŇÑИЙП∩№¶","nńňñийпⁿ  ","OÒÓÔÕÖŐ δΦ","oòóôõöőðσφ","PФÞ ₧     ","pфþр      ","Q         ","q         ","RŔŘ Я®­    ","rŕřτя     ","SЅŚŠŞ$§   ","sѕśšş     ","TТŢŤГΓ    ","tтţťг     ","UÙÚÛÜŮŰЦµ ","uùúûüůűц  ","V         ","v         ","WШЩ       ","wшщ       ","XЖх       ","xж×¤      ","YЧУЎÝ ¥   ","yчуўýÿ    ","ZŹŻŽ      ","zźżž      ","ЮΩπ       ","ю         ","          ","          ","▲↑^⌂      ","▼↓ˇ       ","►→>≥»     ","◄←<≤«     ","↕↨↔       ","¡!|‼#&    ","¿?        ","+÷±†‡     ","-¯_       ","=≡‗       ","~≈        ",'"`´‘’“”¨˘˝',":;….,˛¸   ","([{⌠/%    ",")]}⌡\\    ","☺☻♠♣♥♦♫♪  ","◘◙☼*○•∙·  ","♀♂√¬⌐∟    ","          ","          ","░▒▓█▄▌▐▀■▬","─┤├┌┐└┘┴┬┼","│╡╞╒╕╘╛╧╤╪","║╢╟╓╖╙╜╨╥╫","═╣╠╔╗╚╝╩╦╬"]},{name:"Abecedario",value:["ABCDEFGHIJ","KLMNÑOPQRS","TUVWXYZ   ","          ","abcdefghij","klmnñopqrs","tuvwxyz   "]},{name:"Letras Acentuadas",value:["ÀÁÂÃÄÅĂĄÆ ","ÈÉÊËĘĚ    ","ÌÍÎÏ      ","ÒÓÔÕŐÖ    ","ÙÚÛÜŰŮ    ","          ","àáâãäåăąæ ","èéêëęě    ","ìíîï      ","òóôõőö    ","ùúûüűů    ","          ","ÇĆČĎÐĐĹĽŁ ","ŃŇŔŘŚŠŞŢŤÝ","ŹŻŽ       ","          ","çćčďðđĺľł ","ńňŕřśšşţťý","źżž      ÿ"]},{name:"Griego - Ruso",value:["ΓΘΩΣΦ     ","αδεσφτπ   ","          ","АБВГДЕЖЗИЙ","КЛМНОПРСТУ","ФХЦЧШЩЪЫЬЭ","ЮЯЁЄЅІЇЈЎ ","          ","абвгдежзий","клмнопрсту","фхцчшщъыьэ","юяёєѕіїјў "]},{name:"Simbolos",value:["☺☻♠♣♥♦♫♪♀♂","◘◙○☼•     ","§£€¥$¢    ","¡!|‼#&¿?†‡","+-×÷%=≡~≈ ","↑↓→←↕↨↔   ","▲▼►◄      ","<>√⌂∞∟⌐   ","≤≥        "]},{name:"Bloques",value:["░▒▓█      ","▄▌▐▀■▬    ","          ","┌──┬──┬──┐","│  │  │  │","├──┼──┼──┤","│  │  │  │","└──┴──┴──┘","┌┐└┘┴┬    ","─│┤┼├     ","          ","╔══╦══╦══╗","║  ║  ║  ║","╠══╬══╬══╣","║  ║  ║  ║","╚══╩══╩══╝","╔╗╚╝╩╦    ","═║╣╬╠     ","          ","╒══╤══╤══╕","│  │  │  │","╞══╪══╪══╡","│  │  │  │","╘══╧══╧══╛","╒╕╘╛╧╤    ","═│╡╪╞     ","          ","╓──╥──╥──╖","║  ║  ║  ║","╟──╫──╫──╢","║  ║  ║  ║","╙──╨──╨──╜","╓╖╙╜╨╥    ","─║╢╫╟     "]}];function K(){X(),V(0)}function X(){const e=u("char-selector");R.map((t,n)=>{e.innerHTML+=`<option value="${n}">${t.name}</option>`}),e.addEventListener("change",t=>V(t.target.value))}function V(e){let t="<table><tbody>";R[e].value.forEach(n=>{t+="<tr>";const o=n.length;for(let r=0;r<o;r++)t+=`<td>${n[r]}</td>`;t+="</tr>"}),t+="</tbody></table>",u("char-picker").innerHTML=t,F()}function F(){l.onColorChange("charPicker",t=>{u("char-picker").style.color=t}),l.onBackgroundChange("charPicker",t=>{t!==A[16]?(u("char-picker").style.background="none",u("char-picker").style.backgroundColor=t):(u("char-picker").style.background='url("./assets/transparency.png")',u("char-picker").style.backgroundColor=A[0])}),l.onBackgroundChange("charPicker-Hover",t=>{const n=A.findIndex(o=>o===t);[7,8,10,11,14,15].includes(n)?u("char-picker").setAttribute("dark",""):u("char-picker").removeAttribute("dark","")});let e=null;N("#char-picker td",t=>{t.addEventListener("click",()=>{e!==null&&e.removeAttribute("selected"),t.setAttribute("selected",""),l.char=t.innerHTML,e=t})})}function J(){K()}function Q(){l.onCharChange("charPreview",e=>{u("char-preview").innerHTML=e}),l.onColorChange("charPreview",e=>{u("char-preview").style.color=e}),l.onBackgroundChange("charPreview",e=>{e!==A[16]?(u("char-preview").style.background="none",u("char-preview").style.backgroundColor=e):(u("char-preview").style.background='url("./assets/transparency.png")',u("char-preview").style.backgroundColor=A[0])})}function U(){W(),Z()}function W(){const e=[["black","rgba(0, 0, 128, 1)","rgba(0, 128, 0, 1)","rgba(0, 128, 128, 1)","rgba(128, 0, 0, 1)","rgba(128, 0, 128, 1)","rgba(128, 128, 0, 1)","rgba(192, 192, 192, 1)"],["rgba(128, 128, 128, 1)","rgba(0, 0, 255, 1)","rgba(0, 255, 0, 1)","rgba(0, 255, 255, 1)","rgba(255, 0, 0, 1)","rgba(255, 0, 255, 1)","rgba(255, 255, 0, 1)","rgba(255, 255, 255, 1)","rgba(0 ,0 ,0 ,0)"]];let t="<table><tbody><tr>";e[0].map((n,o)=>t+=`<td pos="${o}" style="background-color: ${n}"></td>`),t+="</tr><tr>",e[1].map((n,o)=>t+=`<td pos="${8+o}" style="background-color: ${n}"></td>`),t+="</tr></tbody></table>",u("color-picker").innerHTML=t}function Z(){N("#color-picker td",e=>{e.addEventListener("click",()=>{const t=e.getAttribute("pos");l.color=A[t]}),e.addEventListener("contextmenu",t=>{const n=e.getAttribute("pos");l.background=A[n],t.preventDefault()})})}u("tool-pencil").addEventListener("click",()=>{let e={removeAttribute:()=>null},t=!1;l.tool="pencil",h.unbindAll(),h.mousedown=({target:i})=>{t=!0,r(),n(i)},h.mouseover=({target:i,preview:b})=>{t?n(i):(r(),o(b),e=b)},h.mouseup=({preview:i})=>{t=!1,i!==null&&(o(i),e=i)},h.canvas_mouseleave=()=>{r()},l.onToolChange("tool-pencil",()=>{r(),l.offToolChange("tool-pencil")});function n(i){i.innerHTML=l.char,i.style.color=l.color,i.style.background=l.background}function o(i){i.innerHTML=l.char,i.style.color=l.color,i.style.background=l.background,i.style.opacity=L(`layer-${l.layer}`).opacity}function r(){e.innerHTML="",e.removeAttribute("style")}});const x={value:0,onChange:function(){},set(e){this.value=e},increase(){this.onChange("+")},decrease(){this.value!==0&&this.onChange("-")}};u("tool-eraser").addEventListener("click",()=>{let e={id:"",removeAttribute:()=>null},t=!1,n=!1;l.tool="eraser",h.unbindAll(),h.mousedown=({target:a})=>{t=!0,o(a)},h.mouseover=({target:a,preview:c})=>{t?(i(),o(a)):(i(),r(c)),n=!0,e=c},h.mouseup=({preview:a})=>{a!==null&&r(a),t=!1},h.canvas_mouseleave=()=>{i(),n=!1},x.onChange=a=>{a==="+"&&(x.set(x.value+1),i(),n&&h.mouseover({preview:e})),a==="-"&&(i(),x.set(x.value-1),n&&h.mouseover({preview:e}))},l.onToolChange("tool-eraser",()=>{i(),l.offToolChange("tool-eraser")});function o(a){const c=k.layerList[`layer-${l.layer}`];b(a).forEach(({x:d,y:g})=>{typeof c[g]<"u"&&typeof c[g][d]<"u"&&(c[g][d].innerHTML="",c[g][d].removeAttribute("style"))})}function r(a){const c=k.layerList["preview-layer"];b(a).forEach(({x:d,y:g})=>{typeof c[g]<"u"&&typeof c[g][d]<"u"&&(c[g][d].innerHTML="█",c[g][d].setAttribute("hover",""))})}function i(){const a=k.layerList["preview-layer"];b(e).forEach(({x:c,y:d})=>{typeof a[d]<"u"&&typeof a[d][c]<"u"&&(a[d][c].innerHTML="",a[d][c].removeAttribute("hover"))})}function b(a){const{x:c,y:d}=S(a),g=[];let y=x.value;if(y!==0)for(;y!==0;){for(let v=d-y;v<d+y*2;v++)for(let s=c-y;s<c+y*2;s++)g.push({x:s,y:v});y--}else g.push({x:c,y:d});return g}});u("tool-fill").addEventListener("click",()=>{let e={removeAttribute:()=>null};l.tool="fill",h.unbindAll(),h.mouseover=({preview:r})=>{o(),n(r),e=r},h.mousedown=({target:r})=>{const i=S(r).x,b=S(r).y,a={background:L(r).backgroundColor,color:L(r).color,char:r.innerHTML},c=k.layerList[`layer-${l.layer}`];let d=[];for(g()&&d.push({e:c[b][i],x:i,y:b});d.length!==0;){const s=[];d.forEach(({e:m,x:f,y:C})=>{[{x:f-1,y:C},{x:f+1,y:C},{y:C-1,x:f},{y:C+1,x:f}].forEach($=>{const z=$.x,_=$.y;if(y(z,_)){const G=s.find(j=>j.x===z&&j.y===_),O=c[_][z];v(O)&&typeof G>"u"&&s.push({e:O,x:z,y:_})}}),t(m)}),d=s}function g(){let{color:s,backgroundColor:m}=r.style,f=!1;if(s=C(s,"f"),m=C(m,"b"),s!==l.color&&(f=!0),m!==l.background&&(f=!0),r.innerHTML!==l.char&&(f=!0),f)return!0;return!1;function C($,z){if($.indexOf("rgb(")!==-1)return $.replace("rgb(","rgba(").replace(")",", 1)");if($===""){if(z==="f")return l.color;if(z==="b")return l.background}return $}}function y(s,m){return s>=0&&s<p.size.x&&m>=0&&m<p.size.y}function v(s){return L(s).backgroundColor===a.background&&L(s).color===a.color&&s.innerHTML===a.char}},h.canvas_mouseleave=()=>{o()},l.onToolChange("tool-fill",()=>{o(),l.offToolChange("tool-fill")});function t(r){r.innerHTML=l.char,r.style.color=l.color,r.style.background=l.background}function n(r){r.innerHTML=l.char,r.style.color=l.color,r.style.background=l.background,r.style.opacity=L(`layer-${l.layer}`).opacity}function o(){e.innerHTML="",e.removeAttribute("style")}});const M=T(":root"),q=L(M);u("tool-zoom").addEventListener("click",()=>{l.tool="zoom",h.unbindAll(),h.click=()=>{const e=Number(q.getPropertyValue("--zoomLevel"));M.style.setProperty("--zoomLevel",e+1)},h.contextmenu=({event:e})=>{e.preventDefault();const t=Number(q.getPropertyValue("--zoomLevel"));t!==1&&M.style.setProperty("--zoomLevel",t-1)}});const I=u("canvas"),H=L("canvas");u("tool-move").addEventListener("click",()=>{let e=!1;l.tool="move",h.unbindAll(),h.mousedown=()=>{l.tool="moving",e=!0},h.global_mousemove=({event:t})=>{if(e){const n=Number(H.top.slice(0,H.top.length-2)),o=Number(H.left.slice(0,H.left.length-2)),r=t.movementX,i=t.movementY;I.style.top=`${n+i}px`,I.style.left=`${o+r}px`}},h.mouseup=()=>{l.tool="move",e=!1}});const h={global_contextmenu:function(){},global_mousedown:function(){},global_mousemove:function(){},canvas_mouseleave:function(){},mouseover:function(){},mousedown:function(){},mouseup:function(){},click:function(){},contextmenu:function(){},unbindAll(){const e=Object.entries(this);for(const[t]of e)t!=="unbindAll"&&(this[t]=function(){})}};function ee(){let e={x:null,y:null},t={x:null,y:null};p.onSizeChange("tool-picker",n=>{t=n}),k.onChange("tool-picker",n=>{n.parentElement.id==="preview-layer"&&(t.x!==e.x||t.y!==e.y)&&(e=t,te())})}let D=!1;function te(){N("#preview-layer td",e=>{E({element:e,e:"mouseover",f:"mouseover"}),E({element:e,e:"mousedown",f:"mousedown"}),E({element:e,e:"click",f:"click"}),E({element:e,e:"contextmenu",f:"contextmenu"})}),D||(E({element:u("canvas"),e:"mouseleave",f:"canvas_mouseleave"}),E({element:document,e:"contextmenu",f:"global_contextmenu"}),E({element:document,e:"mousedown",f:"global_mousedown"}),E({element:document,e:"mousemove",f:"global_mousemove"}),E({element:document,e:"mouseup",f:"mouseup"}),l.onToolChange("tool-declaration",e=>{u("preview-layer").setAttribute("tool",e),u("tool-picker").setAttribute("tool",e)}),D=!0)}function E({element:e,e:t,f:n}){e.addEventListener(t,o=>{l.layer!==null&&h[n](ne(o))})}function ne(e){let t=null,n=null;return e.target.offsetParent!==null&&e.target.offsetParent.id==="preview-layer"&&(t=T(`.layer[n="${l.layer}"] #${e.target.id}`),n=e.target),{event:e,preview:n,target:t}}function S(e){const t=e.id,n=Number(t.slice(1,t.indexOf("-"))),o=Number(t.slice(t.indexOf("-")+1,t.length));return{x:n,y:o}}function oe(){Q(),U(),ee()}function re(){const e=T("#set-canvas-size #x"),t=T("#set-canvas-size #y");u("set-canvas-size").addEventListener("submit",n=>{const o=Number(e.value),r=Number(t.value);p.setSize(o,r),n.preventDefault()}),p.onSizeChange("set-canvas-size",n=>{e.value=n.x,t.value=n.y})}function le(){const e=u("transparency"),t=u("transparency-value");e.addEventListener("mousedown",n=>{u(`layer-${l.layer}`).style.opacity=n.target.value/100,t.innerHTML=`${n.target.value}%`}),e.addEventListener("mousemove",n=>{u(`layer-${l.layer}`).style.opacity=n.target.value/100,t.innerHTML=`${n.target.value}%`}),e.addEventListener("mouseup",n=>{u(`layer-${l.layer}`).style.opacity=n.target.value/100,t.innerHTML=`${n.target.value}%`}),l.onLayerChange("transparency",n=>{if(u(`layer-${n}`)!==null){const o=L(u(`layer-${n}`)).opacity*100;e.removeAttribute("disabled"),e.value=o,t.innerHTML=`${o}%`}else e.setAttribute("disabled",""),t.innerHTML="--%"}),u("add-layer").addEventListener("click",()=>{ae()})}function ae(){const e=p.size.x,t=p.size.y,n=document.querySelectorAll(".layer").length,o=document.createElement("table"),r=document.createElement("tbody");o.id=`layer-${n}`,o.className="layer",o.setAttribute("n",n),o.setAttribute("style",`z-index: ${n*-1};`);for(let i=0;i<t;i++){const b=document.createElement("tr");b.id=`y${i}`;for(let a=0;a<e;a++){const c=document.createElement("td");c.id=`p${a}-${i}`,c.className="pixel",b.append(c)}r.append(b)}o.append(r),u("canvas").append(o),p.applyChanges()}let B=()=>null,P=()=>null;function ie(){let e="";k.onChange("layers-options-container",n=>{if(n.parentElement.id!=="preview-layer"){const o=Number(n.parentElement.getAttribute("n")),r=k.getSize(),i=u(`layer-${o}`);o===0&&(e=""),e+=`
        <div
          n="${o}"
          class="layers-options-container-item" 
          ${l.layer===o?"selected":""}
          ${i.style.display==="none"?"hide":""}
        >
          <span>${o+1})</span>
          <div id="item-preview"></div>
          <button class="hide" n="${o}"></button>
          ${o!==0?`<button class="remove" n="${o}"></button>`:""}
        </div>

        <divider></divider>
      `,o===r-1&&(u("layers-options-container").innerHTML=e,ce())}}),l.onLayerChange("layers-options-container",n=>{const o=T(`.layers-options-container-item[n="${l.layer}"]`),r=T(`.layers-options-container-item[n="${n}"]`);o!==null&&o.removeAttribute("selected"),r!==null&&r.setAttribute("selected","")}),document.addEventListener("mousemove",n=>B(n));let t;document.addEventListener("mousedown",n=>{n.target.offsetParent!==null&&n.target.offsetParent.id==="preview-layer"&&(t=!0)}),document.addEventListener("mouseup",n=>{P(n),t&&(Y(n),t=!1)})}function ce(){N(".layers-options-container-item",(e,t)=>{const n=e.children[2],o=e.children[3],r=Number(e.getAttribute("n"));Y(r,e),n.addEventListener("click",()=>{se(r,e)}),t!==0&&o.addEventListener("click",()=>{ue(r),p.applyChanges()}),e.addEventListener("click",i=>{de(r,e,i)}),ye(r,e)})}function Y(e,t){const n=p.size.x,o=p.size.y;if(typeof t<"u"){const i=document.createElement("canvas");let b=n,a=o,c=0;for(;;){const d=125/(c+1),g=60/(c+1);if(d<n||g<o)break;c++}c!==0&&(i.setAttribute("width",b*c),i.setAttribute("height",a*c),i.setAttribute("scale",c),t.children[1].replaceChildren(i)),r(e)}else l.layer!==null&&r(l.layer);function r(i){const b=T(`.layers-options-container-item[n="${i}"] canvas`),a=Number(b.getAttribute("scale")),c=b.getContext("2d");c.clearRect(0,0,b.width,b.height),k.layerList[`layer-${i}`].forEach((d,g)=>{d.forEach((y,v)=>{const{color:s,backgroundColor:m}=L(y),f=y.innerHTML;let C;f!==""&&f!==" "&&s!==A[16]?C=s:C=m,c.fillStyle=C,c.fillRect(v*a,g*a,a,a)})})}}function se(e,t){t.getAttribute("hide")===null?(u(`layer-${e}`).style.display="none",t.setAttribute("hide",""),e===l.layer&&(l.layer=null)):(u(`layer-${e}`).style.display="block",t.removeAttribute("hide"),l.layer===null&&(l.layer=e))}function ue(e){let t=!1;N("table[n]",n=>{const o=Number(n.getAttribute("n"));if(t){const r=o-1;k.layerList[`layer-${r}`]=k.layerList[n.id],delete k.layerList[n.id],n.id=`layer-${r}`,n.setAttribute("n",r),n.style.zIndex=r*-1}o===e&&(k.remove(n.id),t=!0,n.remove(),o===l.layer&&(l.layer=null))}),p.applyChanges()}function de(e,t,n){let o=!0;t.getAttribute("hide")!==null&&(o=!1),n.target.localName==="button"&&(o=!1),o&&(l.layer=e)}function ye(e,t){const n=L(t),o=g(),r=u("layers-options-container"),i=document.getElementsByTagName("divider");let b=[],a;t.addEventListener("mousedown",y=>{y.target.localName!=="button"&&(B=c,P=d,a=null)});function c(y){const v=Number(n.top.slice(0,n.top.length-2))+y.movementY;if(t.getAttribute("moving")===null){t.setAttribute("moving",""),t.setAttribute("style",`top: ${t.offsetTop}px`),r.setAttribute("moving",""),t.parentNode.insertBefore(o,t);for(let s=0;s<i.length;s++)b.push({e:i.item(s),start:s!==0?i.item(s).offsetTop:0,end:s!==i.length-1?i.item(s+1).offsetTop:99999})}v>=40&&(t.style.top=`${v}px`),b.map((s,m)=>{const f=v+115;f>=s.start&&f<s.end?(s.e.setAttribute("target",""),a=m):s.e.removeAttribute("target")})}function d(){if(t.removeAttribute("moving"),t.removeAttribute("style"),r.removeAttribute("moving"),o.remove(),b.forEach(y=>y.e.removeAttribute("target")),b=[],B=()=>null,P=()=>null,a!==null&&a!==e){const y=document.querySelectorAll("table[n]");let v=l.layer;y.forEach(s=>{const m=Number(s.getAttribute("n"));if(a-e>0){if(m>e&&m<=a){const f=m-1;s.id=`layer-${f}`,s.setAttribute("n",f),s.style.zIndex=f*-1,s.parentNode.insertBefore(s,y[m]),l.layer===m&&(v=f)}m===e&&(s.id=`layer-${a}`,s.setAttribute("n",a),s.style.zIndex=a*-1,s.parentNode.insertBefore(s,y[a+1]),l.layer===m&&(v=a))}if(a-e<0){if(m<e&&m>=a){const f=m+1;s.id=`layer-${f}`,s.setAttribute("n",f),s.style.zIndex=f*-1,s.parentNode.insertBefore(s,y[f]),l.layer===m&&(v=f)}m===e&&(s.id=`layer-${a}`,s.setAttribute("n",a),s.style.zIndex=a*-1,s.parentNode.insertBefore(s,y[a]),l.layer===m&&(v=a))}}),l.layer=v,p.applyChanges()}}function g(){const y=document.createElement("div");return y.className="layers-options-container-ghost-item",y}}function be(){le(),ie(),u("add-layer").click()}function ge(){re(),be()}function me(){p.onSizeChange("layers-resize",(e,t)=>{N("#canvas table tbody",b=>{const a=e.x-t.x,c=e.y-t.y;let d=()=>null,g=()=>null;a>0&&(d=r),a<0&&(d=i),c>0&&(g=n),c<0&&(g=o),g(b,c),d(b,a),k.save(b)});function n(b,a){const c=b.getElementsByTagName("tr").length;for(let d=0;d<a;d++){let g=`<tr id="y${d+c}">`;for(let y=0;y<t.x;y++)g+=`<td id="p${y}-${d+c}" class="pixel"></td>`;g+="</tr>",b.innerHTML+=g}}function o(b,a){const c=b.getElementsByTagName("tr"),d=c.length+a;for(let g=0;g<a*-1;g++)c[d].remove()}function r(b,a){const c=b.getElementsByTagName("tr"),d=c[0].getElementsByTagName("td").length,g=c.length;for(let y=0;y<g;y++)for(let v=0;v<a;v++)c[y].innerHTML+=`<td id="p${v+d}-${y}" class="pixel"></td>`}function i(b,a){const c=b.getElementsByTagName("tr"),d=c[0].getElementsByTagName("td").length+a,g=c.length;for(let y=0;y<g;y++)for(let v=0;v<a*-1;v++)c[y].children[d].remove()}}),l.onLayerChange("preview-layer",e=>{e===null?u("preview-layer").setAttribute("invalid",""):u("preview-layer").removeAttribute("invalid")})}let w=null;document.addEventListener("keydown",e=>{if(!e.repeat)switch(e.key){case"+":{l.tool==="eraser"&&x.increase();break}case"-":{l.tool==="eraser"&&x.decrease();break}case" ":{w!=="move"&&w!=="moving"&&(w=l.tool,u("tool-move").click());break}}});document.addEventListener("keyup",e=>{switch(e.key){case" ":{w!==null?u(`tool-${w}`).click():(u("canvas").removeAttribute("tool"),u("tool-picker").removeAttribute("tool"),l.tool=null,h.unbindAll()),w=null;break}}});document.fonts.ready.then(()=>{J(),oe(),ge(),me(),fe(),document.getElementById("tool-pencil").click(),document.querySelector("#char-picker td").click()});function fe(){l.char="",l.color=A[15],l.background=A[16],l.layer=0,p.setSize(80,25)}
